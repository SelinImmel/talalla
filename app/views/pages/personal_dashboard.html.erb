<div class="container main-container">
  <div class="left-pannel">
    <div class="first-card-personal">
      <div class="avatar-and-buttons">
        <div class="avatar-talalla">
          <%= cl_image_tag current_user.photo, crop: :fill %>
        </div>
        <%= link_to 'Edit', edit_user_registration_path, class: 'btn btn-outline-primary btn-sm'%>
        <!-- <div class="global-button mt-3"> -->
        <!-- </div> -->
      </div>
      <div class="description-talalla">
        <h2><%= current_user.first_name %> <%= current_user.last_name %> <br> </h2>
          <hr>
        <p><%= current_user.address %> <br>
        <%= current_user.email %></p>
        <p>About you: </p>
      </div>
    </div>

    <!-- lessons schedule -->
    <div class="second-card schedule">
      <h1>My upcoming classes</h1>
      <div class="lessons-cards">

        <%# current_user.bookings.each do |booking| %>
          <%# booking.lesson.start_date.each do |date| %>
            <%#= date %>
          <%# end %>
        <%# end %>

        <% @booking_dates.each do |date| %>
          <%= date.to_formatted_s(:long_ordinal) %>
          <% Lesson.joins(:bookings).where(bookings: { user_id: current_user.id }).where(start_date: date).each do |lesson| %>
            <%= lesson.name %>
          <% end %>
        <% end %>

        <% if !Booking.where(user_id: current_user).empty? %>
          <% current_user.bookings.each do |booking| %>
          <h2 class="date-title"><%= booking.lesson.start_date.to_formatted_s(:long_ordinal) %></h2>
              <div class="lesson-card">
                <div class="lesson-card-content">
                  <div class="lesson">
                    <%= booking.lesson.name %>
                  </div>
                  <div class="time">
                      <%= booking.lesson.start_time.strftime('%H:%M') %> -
                      <%= booking.lesson.end_time.strftime('%H:%M') %>
                  </div>
                  <div>
                    <%= cl_image_tag booking.lesson.user.photo, class: "avatar" %>
                  </div>
                  <div class="name-teacher">
                      <%= booking.lesson.user.first_name %>
                  </div>
                </div>
              </div>

            <% end %>
        <% end %>
      </div>
        <%= link_to "Book a lesson", studio_lessons_path(current_user.studio), class: 'btn btn-primary btn-sm'%>
        <%# if !@available_usage || !@date_validity %>
    </div>
  </div>

  <div class="right-pannel">
    <div class="third-card">
      <h2> My current   subscription:</h2>
      <hr>
      <div class="my-subscription-container">
          <% current_user.user_plans.each do |user_plan| %>
            <% left_usage = user_plan.left_usage - user_plan.bookings.size %>
            <% if left_usage > 0 && user_plan.end_date > Date.today %>
              <b><%= left_usage %></b> / <b><%= user_plan.order.subscription.name %></b> remaining
              <br>Valid from <%= user_plan.start_date.to_formatted_s(:rfc822) %> to <%= user_plan.end_date.to_formatted_s(:rfc822) %>
            <% end %>
          <% end %>

      </div>


      <div class="subscription-cards">
        <% @subscriptions.each do |subscription| %>
          <div class="subscription-card text-center">
           <%= subscription.name.upcase %>:<br> <%= subscription.content %>
            <div>
            <%= link_to 'Buy  ', orders_path(subscription_id: subscription), method: :post, class: 'btn btn-primary btn-sm' %> </div>
          </div>
        <% end %>
      </div>
    </div>

    <div class="calendar-notes-container">
      <div class="title-calendar d-flex justify-content-between">
        <h2>My calendar / diary </h2>
        <hr>
        <div><%= link_to "Add note", new_note_path, class: 'btn btn-primary btn-sm'%></div>
      </div>
      <div class="calendar">
          <%= month_calendar(events: current_user.notes, attribute: :date) do |date, notes| %>
            <%= date.day %>
            <% if Note.where(date: date.to_datetime, user: current_user).exists? %>
              <%= link_to notes_path(date: date), remote: true do  %>
                <i class="fas fa-sticky-note" style="color: #6d8092"></i>
              <% end %>
            <% end %>
            <% if Booking.where(date: date.to_datetime, user: current_user).exists? %>
              <div class="booked_lesson"></div>
            <% end %>
          <% end %>
        </div>
      <div class="legend">

      </div>
      <div class="notes">
        <h2>Notes</h2>
      </div>
    </div>
  </div>
</div>

<%# notes.each do |note| %>
  <!-- <p><%#= link_to note.title, personal_dashboard_path %></p> -->
<%# end %>

<!--
      <%# current_user.notes.each do |note| %>
      <p> <strong> <%#= note.title %> </strong> <br>
        <%#= note.content %> </p>
      <p> <%#= link_to "Edit",  edit_note_path(note)%> <%#= link_to "Delete", note_path(note), method: :delete %></p>
      <hr>
      <%# end %> -->

